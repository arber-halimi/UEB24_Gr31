<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Museum Ticket Purchase</title>
    <link rel="stylesheet" href="./assets/style/ticket.css" />
    <link rel="stylesheet" href="./assets/style/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div id="header"></div>

    <main>
      <div class="event-cards-container">
        <div class="event-card" onclick="openModal('Fossil Exhibition', 25)">
          <img
            src="./assets/CATALOG/foto.creatures/Mammuthus.jpg"
            alt="Art Exhibition"
          />
          <h3>Fossil Exhibition</h3>
          <p>Click To Buy Tickets!</p>
        </div>
        <div class="event-card" onclick="openModal('Pictures Tour', 20)">
          <img
            src="./assets/CATALOG/foto,paintings/girl-pearl-earring.webp"
            alt="History Tour"
          />
          <h3>Pictures Tour</h3>
          <p>Click To Buy Tickets!</p>
        </div>
        <div
          class="event-card"
          onclick="openModal('Science Revolution Fair', 15)"
        >
          <img
            src="./assets/CATALOG/foto.old machine/Benz Patent-Motorwagen.webp"
            alt="Science Fair"
          />
          <h3>Science Revolution Fair</h3>
          <p>Click To Buy Tickets!</p>
        </div>
      </div>

      <div class="forms-container">
        <form id="ticketForm">
          <h2>Ticket Purchase</h2>

          <label for="name">Name:</label>
          <input
            type="text"
            id="name1"
            name="name"
            required
            placeholder="Enter your name"
          />

          <label for="surname">Surname:</label>
          <input
            type="text"
            id="surname1"
            name="surname"
            required
            placeholder="Enter your surname"
          />

          <label for="phone">Phone:</label>
          <input
            type="tel"
            id="phone1"
            name="phone"
            required
            placeholder="Enter your phone number"
            pattern="[0-9]{10}"
            inputmode="numeric"
          />

          <label for="email">Email:</label>
          <input
            type="email"
            id="email1"
            name="email"
            required
            placeholder="Enter your email"
          />

          <label for="ticket-date">Date of Ticket:</label>
          <input type="date" id="ticket-date" name="ticket-date" required />

          <div class="price" id="ticket-price">Ticket Price: $0</div>

          <fieldset>
            <legend>Payment Method:</legend>
            <div class="payment-option">
              <input
                type="radio"
                id="card"
                name="payment-method"
                value="Card"
                required
              />
              <label for="card">Card</label>
            </div>

            <div class="payment-option">
              <input
                type="radio"
                id="cash"
                name="payment-method"
                value="Cash"
              />
              <label for="cash">Cash on Take</label>
            </div>
            <div class="payment-option">
              <input
                type="radio"
                id="paypal"
                name="payment-method"
                value="PayPal"
              />
              <label for="paypal">PayPal</label>
            </div>
          </fieldset>

          <div class="payment-details" id="card-details" style="display: none">
            <label for="card-number">Card Number:</label>
            <input
              type="text"
              id="card-number"
              name="card-number"
              placeholder="Enter card number"
            />

            <label for="expiry-date">Expiry Date:</label>
            <input type="month" id="expiry-date" name="expiry-date" />

            <label for="cvv">CVV:</label>
            <input
              type="password"
              id="cvv"
              name="cvv"
              placeholder="Enter CVV"
            />
          </div>

          <div class="payment-details" id="paypal-details">
            <label for="paypal-email">PayPal Email:</label>
            <input
              type="email"
              id="paypal-email"
              name="paypal-email"
              placeholder="Enter PayPal email"
            />
          </div>

          <div class="payment-details" id="cash-details" style="display: none">
            <p>
              No additional information is required for Cash on Take. Payment
              will be made at the museum.
            </p>
          </div>

          <div class="button-group">
            <input type="submit" value="Buy Ticket" />
            <input type="reset" value="Reset" />
          </div>
        </form>

        <section id="giveaway">
          <h2>Win Free Tickets!</h2>
          <p>
            Enter our monthly giveaway for a chance to win free tickets to the
            museum! Simply fill in your details below:
          </p>
          <form id="giveaway-form" action="#">
            <label for="giveaway-name">Name:</label>
            <input
              type="text"
              id="giveaway-name"
              name="giveaway-name"
              required
              placeholder="Enter your name"
            />

            <label for="giveaway-email">Email:</label>
            <input
              type="email"
              id="giveaway-email"
              name="giveaway-email"
              required
              placeholder="Enter your email"
            />

            <button type="submit">Enter Giveaway</button>
          </form>
        </section>
      </div>

      <div id="ticketModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <form id="ticketForm">
            <h2 id="eventTitle">Ticket Purchase</h2>
            <p id="eventPrice">Price: $0</p>

            <!-- Adult/Children Selection -->
            <fieldset>
              <legend>Ticket Type:</legend>
              <div class="payment-option">
                <input
                  type="radio"
                  id="adult"
                  name="ticket-type"
                  value="Adult"
                  checked
                />
                <label for="adult">Adult</label>
              </div>

              <div class="payment-option">
                <input
                  type="radio"
                  id="children"
                  name="ticket-type"
                  value="Children"
                />
                <label for="children">Children</label>
              </div>
            </fieldset>

            <!-- Form Fields -->
            <label for="name">Name:</label>
            <input
              type="text"
              id="name"
              name="name"
              required
              placeholder="Enter your name"
            />

            <label for="surname">Surname:</label>
            <input
              type="text"
              id="surname"
              name="surname"
              required
              placeholder="Enter your surname"
            />

            <label for="phone">Phone:</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              required
              placeholder="Enter your phone number"
              pattern="[0-9]{10}"
              inputmode="numeric"
            />

            <label for="email">Email:</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              placeholder="Enter your email"
            />

            <div class="button-group">
              <input type="submit" value="Buy Ticket" />
              <input type="reset" value="Reset" />
            </div>
          </form>
        </div>
      </div>
    </main>

    <div id="footer"></div>

    <script type="text/javascript">
      $("#header").load("header/header.html");
    </script>

    <script type="text/javascript">
      $("#footer").load("footer/footer.html");
    </script>

    <script>
      let originalPrice = 0; // Store the original price globally

      function openModal(eventName, price) {
        const modal = document.getElementById("ticketModal");
        document.getElementById("eventTitle").textContent = eventName;

        originalPrice = price; // Store the original price correctly when modal opens

        // Initialize the event price to the original price
        document.getElementById(
          "eventPrice"
        ).textContent = `Price: $${originalPrice}`;

        // Ensure radio buttons are reset and select "Adult" by default
        document.getElementById("adult").checked = true;
        updatePriceBasedOnType(); // Update price based on initial selection (Adult)

        modal.style.display = "block";
      }

      function closeModal() {
        const modal = document.getElementById("ticketModal");
        modal.style.display = "none";
      }

      // Event listener to update price based on the selected ticket type (Adult or Children)
      document
        .querySelectorAll('input[name="ticket-type"]')
        .forEach((input) => {
          input.addEventListener("change", function () {
            updatePriceBasedOnType();
          });
        });

      function updatePriceBasedOnType() {
        const ticketType = document.querySelector(
          'input[name="ticket-type"]:checked'
        ).value;
        let finalPrice = originalPrice; // Start with the original price

        if (ticketType === "Children") {
          finalPrice = originalPrice - 5; // $5 discount for children
        }

        document.getElementById(
          "eventPrice"
        ).textContent = `Price: $${finalPrice}`;
      }

      // Close modal when clicking outside content
      window.onclick = function (event) {
        const modal = document.getElementById("ticketModal");
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };

      function navigateToForm(eventName, price) {
        document.getElementById("event").value = eventName;
        document.getElementById(
          "ticket-price"
        ).textContent = `Ticket Price: $${price}`;
        document
          .getElementById("ticketForm")
          .scrollIntoView({ behavior: "smooth" });
      }
      function togglePaymentDetails() {
        const selectedMethod = document.querySelector(
          '[name="payment-method"]:checked'
        ).value;
        document.getElementById("card-details").style.display =
          selectedMethod === "Card" ? "block" : "none";
        document.getElementById("paypal-details").style.display =
          selectedMethod === "PayPal" ? "block" : "none";
        document.getElementById("cash-details").style.display =
          selectedMethod === "Cash" ? "block" : "none";
      }

      const paymentMethods = document.querySelectorAll(
        '[name="payment-method"]'
      );
      paymentMethods.forEach((method) =>
        method.addEventListener("change", togglePaymentDetails)
      );

      const ticketDateInput = document.getElementById("ticket-date");
      const ticketPriceDisplay = document.getElementById("ticket-price");
      const cardDetails = document.getElementById("card-details");
      const paypalDetails = document.getElementById("paypal-details");
      const cashDetails = document.getElementById("cash-details");
      const ticketForm = document.getElementById("ticketForm");

      ticketDateInput.addEventListener("change", () => {
        const selectedDate = new Date(ticketDateInput.value);
        const today = new Date();
        const oneMonthLater = new Date();
        oneMonthLater.setMonth(today.getMonth() + 1);
        if (selectedDate < today || selectedDate > oneMonthLater) {
          alert(
            "Please select a date within the next month and not in the past."
          );
          ticketDateInput.value = "";
        } else {
          const day = selectedDate.getDay();
          const price = day === 0 || day === 6 ? 20 : 15;
          ticketPriceDisplay.textContent = `Ticket Price: $${price}`;
        }
      });

      // Show/hide payment details based on the selected payment method
      paymentMethods.forEach((method) => {
        method.addEventListener("change", () => {
          cardDetails.style.display =
            method.value === "Card" ? "block" : "none";
          paypalDetails.style.display =
            method.value === "PayPal" ? "block" : "none";
          cashDetails.style.display =
            method.value === "Cash" ? "block" : "none";
        });
      });

      ticketForm.addEventListener("submit", (event) => {
        const selectedMethod = [...paymentMethods].find(
          (method) => method.checked
        );
        if (!selectedMethod) {
          alert("Please select a payment method.");
          event.preventDefault();
          return;
        }

        if (selectedMethod.value === "Card") {
          const cardNumber = document
            .getElementById("card-number")
            .value.trim();
          const expiryDate = document
            .getElementById("expiry-date")
            .value.trim();
          const cvv = document.getElementById("cvv").value.trim();

          if (!cardNumber || !expiryDate || !cvv) {
            alert("Please fill in all card details.");
            event.preventDefault();
            return;
          }
        }

        if (selectedMethod.value === "PayPal") {
          const paypalEmail = document
            .getElementById("paypal-email")
            .value.trim();
          if (!paypalEmail) {
            alert("Please fill in your PayPal email.");
            event.preventDefault();
            return;
          }
        }
      });
      function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (emailRegex.test(email)) {
          return true;
        } else {
          alert("Please enter a valid email address.");
          return false;
        }
      }
      function validatePassword(password) {
        const passwordRegex =
          /^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
        if (passwordRegex.test(password)) {
          return true;
        } else {
          alert(
            "Password must be at least 8 characters long, contain one uppercase letter, one number, and one special character."
          );
          return false;
        }
      }
      function validateRequiredFields(form) {
        let isValid = true;
        const requiredFields = form.querySelectorAll("[required]");
        requiredFields.forEach((field) => {
          if (field.value.trim() === "") {
            alert(`${field.name} is required.`);
            isValid = false;
          }
        });
        return isValid;
      }
    </script>
  </body>
</html>
